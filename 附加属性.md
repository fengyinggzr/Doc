# 附加属性

## QQuickAttachedPropertyPropagator使用和不使用的区别
QQuickAttachedPropertyPropagator 与普通的 QML 附加属性（Attached Properties）的关系核心在于 "属性值的继承与传播（Propagation）"。

普通附加属性：是局部的。父对象上设置的值不会自动传给子对象。

`QQuickAttachedPropertyPropagator`：是实现向下传播（从父 `Item` 到子 `Item`）的底层机制。

### 不使用 `QQuickAttachedPropertyPropagator` (普通 `QObject`)

C++ 实现仅继承 `QObject`. 结果: 输出 `Blue` (默认值). 子项完全不知道父项变成了红色.

```qml
// ParentItem
Item {
    // 在父级设置为红色
    Theme.color: "Red"

    // ChildItem
    Item {
        // 这里的 Theme 对象是全新的，与父级无关
        // 因为没有传播机制，它读取的是默认值
        Component.onCompleted: console.log(Theme.color) 
    }
}
```

### 使用 `QQuickAttachedPropertyPropagator`
C++ 实现继承自 `QQuickAttachedPropertyPropagator`, 并正确实现了 `inherit()` 和 `propagate()` 逻辑. 结果: 输出 `Red`. 子项自动继承了父项的设置.

```qml
// ParentItem
Item {
    // 在父级设置为红色
    Theme.color: "Red"

    // ChildItem
    Item {
        // 由于有 Propagator，它会自动查找父级是否设置了 Theme
        // 并继承父级的值
        Component.onCompleted: console.log(Theme.color)
    }
}
```

## 核心概念

### 1. Attached Properties and Attached Signal Handlers

- https://doc.qt.io/qt-6/qtqml-syntax-objectattributes.html#attached-properties-and-attached-signal-handlers
- QML 附加属性的基本概念和使用方法

### 2. Providing Attached Properties

- https://doc.qt.io/qt-6/qtqml-cppintegration-definetypes.html#providing-attached-properties
- 如何在 C++ 中实现附加属性

## 实现示例
### 1. QML_ATTACHED 宏文档

- https://doc.qt.io/qt-6/qqmlengine.html#QML_ATTACHED
- QML_ATTACHED 宏的官方说明

### 2. qmlAttachedProperties() 方法

- https://doc.qt.io/qt-6/qqmlengine.html#qmlAttachedProperties
- 附加属性的工厂方法

## Qt Quick Controls 实际应用

### 1. Material Style Attached Properties

- https://doc.qt.io/qt-6/qtquickcontrols-material.html#attached-properties
- Material 风格如何使用附加属性（Material.primary 等）

### 2. Universal Style Attached Properties

- https://doc.qt.io/qt-6/qtquickcontrols-universal.html#attached-properties
- Universal 风格的附加属性实现

## 最佳实践

### 1. Integrating QML and C++

- https://doc.qt.io/qt-6/qtqml-cppintegration-overview.html
- QML 与 C++ 集成的最佳实践

### 2. Defining QML Types from C++

- https://doc.qt.io/qt-6/qtqml-cppintegration-definetypes.html
- 如何在 C++ 中定义 QML 类型